; Begin
	R0L EQU 0x20
	R0H EQU 0x21
	R1L EQU 0x22
	R1H EQU 0x23
	R2L EQU 0x24
	R2H EQU 0x25
	R3L EQU 0x26
	R3H EQU 0x27
	R4L EQU 0x28
	R4H EQU 0x29
	R5L EQU 0x2A
	R5H EQU 0x2B
	SCL_PORT EQU 0x2C
	SCL_BIT EQU 0x2D
	SDA_PORT EQU 0x2E
	SDA_BIT EQU 0x2F
	ORG 0x0000
	BCF PCLATH,3
	BCF PCLATH,4
	GOTO L0001
	ORG 0x0004
	RETFIE
L0001:
; 1: Dim addr As Word 'variable for storing EEPROM byte address
;       The address of 'addr' is 0x30
	addr EQU 0x30
; 2: Dim data As Byte 'variable for storing EEPROM byte data
;       The address of 'data' is 0x32
	data EQU 0x32
; 3: 
; 4: Symbol sda = PORTC.2 'nickname for SDA pin
;       The address of 'sda' is 0x7,2
; 5: Symbol scl = PORTC.3 'nickname for SCL pin
;       The address of 'scl' is 0x7,3
; 6: 
; 7: For addr = 0 To 31 'the first 32 bytes will be written
	CLRF 0x30
	CLRF 0x31
L0002:
	MOVF 0x30,W
	MOVWF R0L
	MOVF 0x31,W
	MOVWF R0H
	CLRF R1H
	MOVLW 0x1F
	CALL C006
	BTFSS STATUS,Z
	GOTO L0003
; 8: data = 255 - addr 'set the data byte to be written
;       The address of 'oshonsoft_temp_1' is 0x33
	oshonsoft_temp_1 EQU 0x33
	MOVF 0x30,W
	SUBLW 0xFF
	MOVWF 0x33
	MOVF 0x31,W
	BTFSS STATUS,C
	ADDLW 0x01
	SUBLW 0x00
	MOVWF 0x34
	MOVF 0x33,W
	MOVWF 0x32
; 9: I2CWrite sda, scl, 0xa0, addr, data 'perform I2C write operation to serial EEPROM
	MOVLW 0x07
	MOVWF SDA_PORT
	MOVLW 0x04
	MOVWF SDA_BIT
	BSF STATUS,RP0
	BCF TRISC,2
	BCF STATUS,RP0
	MOVLW 0x07
	MOVWF SCL_PORT
	MOVLW 0x08
	MOVWF SCL_BIT
	BSF STATUS,RP0
	BCF TRISC,3
	BCF STATUS,RP0
	CALL IC41
	CALL IC41
	CALL IC31
	MOVLW 0xA0
	CALL IC01
	MOVF 0x31,W
	CALL IC01
	MOVF 0x30,W
	CALL IC01
	MOVF 0x32,W
	CALL IC01
	CALL IC41
; 10: WaitMs 1 'small delay interval
	MOVLW 0x01
	MOVWF R0L
	CLRF R0H
	CALL W001
; 11: Next addr
	MOVLW 0x01
	ADDWF 0x30,F
	MOVLW 0x00
	BTFSC STATUS,C
	ADDLW 0x01
	BTFSC STATUS,C
	GOTO L0003
	ADDWF 0x31,F
	BTFSS STATUS,C
	GOTO L0002
L0003:	MOVLW 0x1F
	ANDWF STATUS,F
; End of program
L0004:	GOTO L0004
; Comparison Routine
C001:	MOVWF R1L
	MOVLW 0x05
	GOTO C007
C002:	MOVWF R1L
	MOVLW 0x02
	GOTO C007
C003:	MOVWF R1L
	MOVLW 0x06
	GOTO C007
C004:	MOVWF R1L
	MOVLW 0x03
	GOTO C007
C005:	MOVWF R1L
	MOVLW 0x04
	GOTO C007
C006:	MOVWF R1L
	MOVLW 0x01
	GOTO C007
C007:	MOVWF R4L
	MOVF R1H,W
	SUBWF R0H,W
	BTFSS STATUS,Z
	GOTO C008
	MOVF R1L,W
	SUBWF R0L,W
C008:	MOVLW 0x04
	BTFSC STATUS,C
	MOVLW 0x01
	BTFSC STATUS,Z
	MOVLW 0x02
	ANDWF R4L,W
	BTFSS STATUS,Z
	MOVLW 0xFF
	RETURN
; Waitms Routine
W001:	MOVF R0L,F
	BTFSC STATUS,Z
	GOTO W002
	CALL W003
	DECF R0L,F
	NOP
	NOP
	NOP
	NOP
	NOP
	GOTO W001
W002:	MOVF R0H,F
	BTFSC STATUS,Z
	RETURN
	CALL W003
	DECF R0H,F
	DECF R0L,F
	GOTO W001
W003:	MOVLW 0x0C
	MOVWF R2H
W004:	DECFSZ R2H,F
	GOTO W004
	NOP
	NOP
	MOVLW 0x12
	MOVWF R1L
W005:	DECFSZ R1L,F
	GOTO W006
	CALL W007
	CALL W007
	NOP
	NOP
	RETURN
W006:	CALL W007
	GOTO W005
W007:	MOVLW 0x0D
	MOVWF R2L
W008:	DECFSZ R2L,F
	GOTO W008
	NOP
	RETURN
; I2CWrite Routine
IC01:	MOVWF R0L
	MOVLW 0x08
	MOVWF R0H
IC02:	RLF R0L,F
	BTFSC STATUS,C
	CALL IC20
	BTFSS STATUS,C
	CALL IC21
	CALL IC22
	CALL IC23
	DECFSZ R0H,F
	GOTO IC02
	CALL IC24
	CALL IC03
	CALL IC25
	CALL IC21
	RETURN
IC03:	CALL IC22
	MOVF SDA_PORT,W
	MOVWF FSR
	MOVF SDA_BIT,W
	ANDWF INDF,W
	ADDLW 0xFF
	CALL IC23
	RETURN
IC31:	CALL IC21
	CALL IC23
	GOTO IC29
IC41:	CALL IC22
	CALL IC20
	GOTO IC29
IC20:	MOVF SDA_PORT,W
	MOVWF FSR
	MOVF SDA_BIT,W
	IORWF INDF,F
	GOTO IC28
IC21:	MOVF SDA_PORT,W
	MOVWF FSR
	COMF SDA_BIT,W
	ANDWF INDF,F
	GOTO IC28
IC22:	MOVF SCL_PORT,W
	MOVWF FSR
	MOVF SCL_BIT,W
	IORWF INDF,F
	GOTO IC28
IC23:	MOVF SCL_PORT,W
	MOVWF FSR
	COMF SCL_BIT,W
	ANDWF INDF,F
	GOTO IC28
IC28:	BSF FSR,7
	COMF INDF,W
	BCF FSR,7
	ANDWF INDF,F
IC29:	NOP
	NOP
	RETURN
IC24:	MOVF SDA_PORT,W
	MOVWF FSR
	BSF FSR,7
	MOVF SDA_BIT,W
	IORWF INDF,F
	RETURN
IC25:	MOVF SDA_PORT,W
	MOVWF FSR
	BSF FSR,7
	COMF SDA_BIT,W
	ANDWF INDF,F
	RETURN
; End of listing
	END
